<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title></title>
		<script src="js/jquery-3.2.1.min.js"></script>
		<script src="js/d3.v4.min.js"></script>
		<style>
		svg .user{
			fill:cornflowerblue;
			}	
			svg .area{
				fill:green;
			}
			path.links{
				fill:none;
				stroke:#666;
				stroke-width:1px;
			}
		</style>
	</head>
	<body>
		<div id="visit"></div>
		<script type="text/javascript">
var width = 960,
    height = 500,
    radius = 240;

var angle = d3.scalePoint()
	.domain([0,180])
    .range([0,1]);

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");

d3.json("data.json", function(error, nodes) {
  if (error) throw error;

  var nodeByName = d3.map(),
      links = [];

  nodes.forEach(function(d) { nodeByName.set(d.name, d); });

  nodes.forEach(function(source) {
    source.connections.forEach(function(target) {
      links.push({source: source, target: nodeByName.get(target)});
    });
  });

  angle.domain(nodes.map(function(d) { return d.name; }));

  var link = svg.append("g")
      .attr("class", "link-wrap")
    .selectAll("path")
      .data(links)
    .enter().append("path")
      .attr("d", curve)
      .attr("class","links");

var pai = Math.PI;
  var node = svg.append("g")
      .attr("class", "nodes")
   .selectAll("g")
      .data(nodes)
    .enter().append("circle")
	 .attr("r", 5)
      .attr("cx", function(d,i){return i*40;})
      .attr("cy", function(d,i){return i*40;})
      .attr("class",function(d,i){
      	if(i < nodes.length-1){
      	var user = "user";
      	}else{
      		var user ="area";
      	}
      	return user;
      });
      
//node.append("text")
//    .attr("dy", ".35em")
//    .attr("x", 6)
//    .text(function(d) { return d.name; })
//  .filter(function(d) { return (angle(d.name) + 90) % 360 > 180; }) // flipped
//    .attr("x", -6)
//    .attr("transform", "rotate(-180)")
//    .style("text-anchor", "end");
});

function curve(link) {
  var a0 = (angle(link.source.name)*10) / 180 * Math.PI,
      a1 = (angle(link.target.name)*10) / 180 * Math.PI,
      x0 = Math.cos(a0) * radius, y0 = Math.sin(a0) * radius,
      x1 = Math.cos(a1) * radius, y1 = Math.sin(a1) * radius,
      dx = x0 - x1,
      dy = y0 - y1,
      l = Math.sqrt(dx * dx + dy * dy);
  return "M" + x0 + "," + y0
      + "c" + l * 2 + "," + l * 2 + " 0 0 1 "
      + x1 + "," + y1;
}

		</script>
	</body>
</html>
